# Программа для работы с датчиками VL53L1X и VL53L5CX

Эта программа предназначена для одновременной работы с несколькими датчиками расстояния VL53L1X и VL53L5CX на Raspberry Pi. Программа автоматически обнаруживает датчики, инициализирует их и изменяет I2C адреса при необходимости.

## Возможности

- Автоматическое обнаружение датчиков на стандартном адресе 0x29
- Изменение I2C адресов датчиков для избежания конфликтов
- Поддержка датчиков VL53L1X и VL53L5CX
- Конфигурация через текстовый файл
- Управление питанием датчиков через GPIO пины XSHUT

## Требования

- Raspberry Pi с установленной системой Linux
- Установленная библиотека wiringPi: `sudo apt-get install wiringpi`
- Подключенные датчики VL53L1X и/или VL53L5CX к I2C шине
- GPIO пины для управления питанием датчиков (XSHUT)

## Сборка

```bash
make
```

## Конфигурация

Создайте файл `sensors_config.txt` в формате:

```
тип_датчика пин_xshut i2c_адрес имя_файла
```

**Поддерживаются комментарии:**
- Строки, начинающиеся с `#`, игнорируются
- Комментарии в конце строки также поддерживаются
- Пустые строки игнорируются

### Параметры:

- **тип_датчика**: 
  - `l1x` - для VL53L1X
  - `l5cx` - для VL53L5CX
  - `tcs` - для TCS34725 (пока не реализовано)

- **пин_xshut**: GPIO пин для управления питанием датчика (XSHUT)

- **i2c_адрес**: Желаемый I2C адрес в шестнадцатеричном формате (например, 0x29, 0x30, 0x31)

- **имя_файла**: Имя файла для сохранения данных датчика

### Пример конфигурации:

```
# Формат: тип_датчика пин_xshut i2c_адрес имя_файла
# Типы датчиков: l1x (VL53L1X), l5cx (VL53L5CX), tcs (TCS34725)

# Левый VL53L1X датчик
l1x 17 0x51 vl53l1x_left

# Левый VL53L5CX датчик  
l5cx 22 0x53 vl53l5cx_left
```

## Тестирование

Для проверки конфигурации без запуска основной программы:

```bash
./test_config.sh
```

Этот скрипт проверит:
- Чтение конфигурационного файла
- Корректность параметров
- Парсинг комментариев

## Запуск

```bash
sudo ./back_ranging
```

**Примечание**: Программа требует root прав для доступа к GPIO и I2C.

## Принцип работы

1. **Инициализация GPIO**: Все пины XSHUT устанавливаются в LOW (датчики выключены)

2. **Последовательная проверка**: Датчики включаются по одному:
   - Включается питание датчика (XSHUT = HIGH)
   - Проверяется наличие устройства на стандартном адресе 0x29
   - Если датчик найден, он инициализируется
   - Если нужен другой адрес, он изменяется
   - Датчик выключается перед проверкой следующего

3. **Финальная активация**: Все успешно инициализированные датчики включаются одновременно

4. **Основной цикл**: Программа читает данные со всех активных датчиков и сохраняет их в файлы

## Структура проекта

```
test/
├── back_ranging.c          # Основной файл программы
├── sensors_config.txt      # Конфигурация датчиков
├── Makefile               # Файл сборки
└── README.md              # Этот файл
```

## Устранение неполадок

### Датчик не обнаружен
- Проверьте подключение I2C шины
- Убедитесь, что датчик получает питание
- Проверьте правильность номера GPIO пина XSHUT

### Ошибка инициализации
- Проверьте, что I2C шина включена: `sudo raspi-config`
- Убедитесь, что библиотеки правильно скомпилированы
- Проверьте права доступа к `/dev/i2c-1`

### Конфликт адресов
- Убедитесь, что в конфигурации указаны разные I2C адреса
- Проверьте, что датчики физически подключены к разным пинам XSHUT

## Лицензия

Этот код использует библиотеки STMicroelectronics для работы с датчиками VL53L1X и VL53L5CX. 